meta {
  name: Admin OAuth Clients - Create
  type: http
  seq: 6
}

post {
  url: {{baseUrl}}/admin/oauth-clients
  body: json
  auth: none
}

headers {
  Content-Type: application/json
  Authorization: Bearer eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJhY3Rvcl9pZCI6InVzZXJfMDFLR1lXUE1IOEdONFpTVkFQQTBRSjJDOTkiLCJhY3Rvcl90eXBlIjoidXNlciIsImF1dGhfaWRlbnRpdHlfaWQiOiJhdXRoaWRfMDFLR1lXUE1HVDlRWEdIQlA5MkdWMDk2NjYiLCJhcHBfbWV0YWRhdGEiOnsidXNlcl9pZCI6InVzZXJfMDFLR1lXUE1IOEdONFpTVkFQQTBRSjJDOTkifSwidXNlcl9tZXRhZGF0YSI6e30sImlhdCI6MTc3MDU2MzI4MSwiZXhwIjoxNzcwNjQ5NjgxfQ.hlnA8537bESqT4UunBnSNIFxEv9Xz0Lb1M3xT7n_Vrs
}

body:json {
  {
    "name": "Shoppee",
    "redirect_uris": [
      "{{redirectUri}}"
    ],
    "grants": [
      "authorization_code",
      "refresh_token"
    ],
    "scopes": [
      "{{scope}}"
    ]
  }
}

tests {
  test("should create client", function () {
    expect([200, 201]).to.include(res.status);
  });
}

script:post-response {
  const body = res.body || {};
  const client = body.oauth_client || body.client || body;
  const clientId = client.client_id || body.client_id;
  const clientSecret = client.client_secret || body.client_secret;
  const recordId = client.id || body.id || body.oauth_client_id;

  if (clientId) {
    bru.setEnvVar("clientId", clientId);
  }
  if (clientSecret) {
    bru.setEnvVar("clientSecret", clientSecret);
  }
  if (recordId) {
    bru.setEnvVar("oauthClientRecordId", recordId);
  }
}
